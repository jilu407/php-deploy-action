# name: remote ssh command
# on: [push]
# jobs:

  # build:
    # name: Build
    # runs-on: ubuntu-latest
    # steps:
    # - name: checkout
      # uses: actions/checkout@v1

    # - name: executing remote ssh commands using password
      # uses: appleboy/ssh-action@
      # with:
        # host: ${{ secrets.HOST }}
        # username: ${{ secrets.USERNAME }}
        # password: ${{ secrets.PASSWORD }}
        # port: ${{ secrets.PORT }}
        
        # script: |

          # cd /var/www/html/

          # git checkout -f 

          # git pull origin master
# 
name: Deploy EC2
on:
  push:
    branches:
      - develop
  pull_request:
    types: [closed]
jobs:
  merge-PR:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install SSH key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.SSH_KEY }}
          name: id_rsa
          known_hosts: ${{ secrets.KNOWN_HOSTS }}
      - name: rsync over ssh
        run: ./deploy_to_aws.sh